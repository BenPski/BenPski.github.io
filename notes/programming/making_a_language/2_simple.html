<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>BenPski - Lambda Calculus: First Implementation</title>
        <link rel="stylesheet" type="text/css" href="../../../css/default.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../../../">BenPski</a>
            </div>
            <div id="navigation">
                <a href="../../../">Home</a>
                <a href="../../../about.html">About</a>
<!--                <a href="/contact.html">Contact</a>-->
                <a href="../../../archive.html">Archive</a>
                <a href="../../../notes.html">Notes</a>
            </div>
        </div>

        <div id="content">
            <h1>Lambda Calculus: First Implementation</h1>

            <p>In the last section started looking at lambda calculus, now want to actually start implementing it and playing with it. Since, it is just a simple implementation it’ll be just trying some different data structures and printing.</p>
<p>For lambda calculus with De Bruijn notation the basic definition written in haskell is:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">data</span> <span class="dt">Expr</span> <span class="fu">=</span> <span class="dt">Index</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb1-2" title="2">          <span class="fu">|</span> <span class="dt">Lambda</span> <span class="dt">Expr</span></a>
<a class="sourceLine" id="cb1-3" title="3">          <span class="fu">|</span> <span class="dt">Apply</span> <span class="dt">Expr</span> <span class="dt">Expr</span></a></code></pre></div>
<p>For rust we can decide how to layout the structure with a bit more control. We can use an immutable data structure or can use a mutable structure with pointers. I’m not too comfortable with rust’s memory system yet, but I know the basic references are Box, RC, and ARC.</p>
<p>Given that I’d like to make some progress in the language and that I’m still not too comfortable with rust to make decent progress, I’m going to be implementing the first version of the language in python because I find it easier to prototype and test with. Also, from here forward the language will be known as <code>bagl</code> for Ben’s Awesomely Good Language.</p>
<h1 id="lambda-calculus-python">Lambda Calculus: Python</h1>
<p>To model an expression first I’ll lay out the structure similarly to the haskell definition:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">class</span> Expr():</a>
<a class="sourceLine" id="cb2-2" title="2">    __metaclass__ <span class="op">=</span> ABCMeta</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb2-5" title="5">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="kw">class</span> Index(Expr):</a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n):</a>
<a class="sourceLine" id="cb2-10" title="10">        <span class="va">self</span>.n <span class="op">=</span> n</a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12"></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="kw">class</span> Lambda(Expr):</a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, expr):</a>
<a class="sourceLine" id="cb2-15" title="15">        <span class="va">self</span>.expr <span class="op">=</span> expr</a>
<a class="sourceLine" id="cb2-16" title="16"></a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="kw">class</span> Apply(Expr):</a>
<a class="sourceLine" id="cb2-19" title="19">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, left, right):</a>
<a class="sourceLine" id="cb2-20" title="20">        <span class="va">self</span>.left <span class="op">=</span> left</a>
<a class="sourceLine" id="cb2-21" title="21">        <span class="va">self</span>.right <span class="op">=</span> right</a></code></pre></div>
<p>This works as a first implementation, but their will be a few inconvenient things about it. First, there are no variables/symbols for representing values when testing, but this should be easy to add. The most annoying problem will be having to define functions that traverse over the expression tree as that can be a bit tedious for objects relative to functional programming languages, this can be handled using the <em>visitor pattern</em>. For the visitor pattern what happens is the data structure (e.g., the expression object tree) defines a method called <code>accept</code> that takes a visitor calls the appropriate visitor method on itself, the visitor then defines the relevant methods to operate on the individual components of the data structure. This makes it a lot like a functor definition in haskell. One issue is that this is quite tedious and a lot of boilerplate to write as the different kinds of nodes in the expression tree grows, but this can be handled with some scripting/metaprogramming. The <code>Expr</code> definition with variables and the visitor pattern implemented is:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">class</span> Expr():</a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co">    The expression tree object for lambda calculus</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-5" title="5">    __metaclass__ <span class="op">=</span> ABCMeta</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="at">@abstractmethod</span></a>
<a class="sourceLine" id="cb3-8" title="8">    <span class="kw">def</span> accept(<span class="va">self</span>, visitor):</a>
<a class="sourceLine" id="cb3-9" title="9">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb3-10" title="10"></a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="kw">class</span> Variable(Expr):</a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co">    Holds a name for a symbol</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-16" title="16"></a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, s):</a>
<a class="sourceLine" id="cb3-18" title="18">        <span class="va">self</span>.s <span class="op">=</span> s</a>
<a class="sourceLine" id="cb3-19" title="19"></a>
<a class="sourceLine" id="cb3-20" title="20">    <span class="kw">def</span> accept(<span class="va">self</span>, visitor):</a>
<a class="sourceLine" id="cb3-21" title="21">        <span class="cf">return</span> visitor.visitVariable(<span class="va">self</span>)</a>
<a class="sourceLine" id="cb3-22" title="22"></a>
<a class="sourceLine" id="cb3-23" title="23"></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="kw">class</span> Index(Expr):</a>
<a class="sourceLine" id="cb3-25" title="25">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="co">    Index in de bruijn notation</span></a>
<a class="sourceLine" id="cb3-27" title="27"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-28" title="28"></a>
<a class="sourceLine" id="cb3-29" title="29">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, n):</a>
<a class="sourceLine" id="cb3-30" title="30">        <span class="va">self</span>.n <span class="op">=</span> n</a>
<a class="sourceLine" id="cb3-31" title="31"></a>
<a class="sourceLine" id="cb3-32" title="32">    <span class="kw">def</span> accept(<span class="va">self</span>, visitor):</a>
<a class="sourceLine" id="cb3-33" title="33">        <span class="cf">return</span> visitor.visitIndex(<span class="va">self</span>)</a>
<a class="sourceLine" id="cb3-34" title="34"></a>
<a class="sourceLine" id="cb3-35" title="35"></a>
<a class="sourceLine" id="cb3-36" title="36"><span class="kw">class</span> Lambda(Expr):</a>
<a class="sourceLine" id="cb3-37" title="37">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-38" title="38"><span class="co">    Lambda abstraction</span></a>
<a class="sourceLine" id="cb3-39" title="39"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-40" title="40"></a>
<a class="sourceLine" id="cb3-41" title="41">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, expr):</a>
<a class="sourceLine" id="cb3-42" title="42">        <span class="va">self</span>.expr <span class="op">=</span> expr</a>
<a class="sourceLine" id="cb3-43" title="43"></a>
<a class="sourceLine" id="cb3-44" title="44">    <span class="kw">def</span> accept(<span class="va">self</span>, visitor):</a>
<a class="sourceLine" id="cb3-45" title="45">        <span class="cf">return</span> visitor.visitLambda(<span class="va">self</span>)</a>
<a class="sourceLine" id="cb3-46" title="46"></a>
<a class="sourceLine" id="cb3-47" title="47"></a>
<a class="sourceLine" id="cb3-48" title="48"><span class="kw">class</span> Apply(Expr):</a>
<a class="sourceLine" id="cb3-49" title="49">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-50" title="50"><span class="co">    Function application</span></a>
<a class="sourceLine" id="cb3-51" title="51"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-52" title="52"></a>
<a class="sourceLine" id="cb3-53" title="53">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, left, right):</a>
<a class="sourceLine" id="cb3-54" title="54">        <span class="va">self</span>.left <span class="op">=</span> left</a>
<a class="sourceLine" id="cb3-55" title="55">        <span class="va">self</span>.right <span class="op">=</span> right</a>
<a class="sourceLine" id="cb3-56" title="56"></a>
<a class="sourceLine" id="cb3-57" title="57">    <span class="kw">def</span> accept(<span class="va">self</span>, visitor):</a>
<a class="sourceLine" id="cb3-58" title="58">        <span class="cf">return</span> visitor.visitApply(<span class="va">self</span>)</a>
<a class="sourceLine" id="cb3-59" title="59"></a>
<a class="sourceLine" id="cb3-60" title="60"></a>
<a class="sourceLine" id="cb3-61" title="61"><span class="kw">class</span> ExprVisitor():</a>
<a class="sourceLine" id="cb3-62" title="62">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-63" title="63"><span class="co">    Visitor definition for the expression tree</span></a>
<a class="sourceLine" id="cb3-64" title="64"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-65" title="65">    __metaclass__ <span class="op">=</span> ABCMeta</a>
<a class="sourceLine" id="cb3-66" title="66"></a>
<a class="sourceLine" id="cb3-67" title="67">    <span class="at">@abstractmethod</span></a>
<a class="sourceLine" id="cb3-68" title="68">    <span class="kw">def</span> visitVariable(<span class="va">self</span>, elem):</a>
<a class="sourceLine" id="cb3-69" title="69">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb3-70" title="70"></a>
<a class="sourceLine" id="cb3-71" title="71">    <span class="at">@abstractmethod</span></a>
<a class="sourceLine" id="cb3-72" title="72">    <span class="kw">def</span> visitIndex(<span class="va">self</span>, elem):</a>
<a class="sourceLine" id="cb3-73" title="73">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb3-74" title="74"></a>
<a class="sourceLine" id="cb3-75" title="75">    <span class="at">@abstractmethod</span></a>
<a class="sourceLine" id="cb3-76" title="76">    <span class="kw">def</span> visitLambda(<span class="va">self</span>, elem):</a>
<a class="sourceLine" id="cb3-77" title="77">        <span class="cf">pass</span></a>
<a class="sourceLine" id="cb3-78" title="78"></a>
<a class="sourceLine" id="cb3-79" title="79">    <span class="at">@abstractmethod</span></a>
<a class="sourceLine" id="cb3-80" title="80">    <span class="kw">def</span> visitApply(<span class="va">self</span>, elem):</a>
<a class="sourceLine" id="cb3-81" title="81">        <span class="cf">pass</span></a></code></pre></div>
<p>To get a view of how the visitor pattern works lets take a look at a simple printer for the expressions. For this variables just display their string, indices show a # and their index, lambdas display a <span class="math inline">\(\lambda\)</span> (or just \) in this case, and apply juxtaposes its values.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">class</span> ExprPrint(ExprVisitor):</a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="kw">def</span> visitVariable(<span class="va">self</span>, elem):</a>
<a class="sourceLine" id="cb4-3" title="3">        <span class="cf">return</span> elem.s</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="kw">def</span> visitIndex(<span class="va">self</span>, elem):</a>
<a class="sourceLine" id="cb4-6" title="6">        <span class="cf">return</span> <span class="st">&quot;#&quot;</span> <span class="op">+</span> <span class="bu">str</span>(elem.n)</a>
<a class="sourceLine" id="cb4-7" title="7"></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="kw">def</span> visitLambda(<span class="va">self</span>, elem):</a>
<a class="sourceLine" id="cb4-9" title="9">        <span class="cf">return</span> <span class="st">&quot;(</span><span class="ch">\\</span><span class="st"> &quot;</span> <span class="op">+</span> elem.expr.accept(<span class="va">self</span>) <span class="op">+</span> <span class="st">&quot;)&quot;</span></a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="kw">def</span> visitApply(<span class="va">self</span>, elem):</a>
<a class="sourceLine" id="cb4-12" title="12">        <span class="cf">return</span> elem.left.accept(<span class="va">self</span>) <span class="op">+</span> <span class="st">&quot; &quot;</span> <span class="op">+</span> elem.right.accept(<span class="va">self</span>)</a></code></pre></div>
<p>Which can be called as:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" title="1"><span class="bu">id</span> <span class="op">=</span> Lambda(Index(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb5-2" title="2">x <span class="op">=</span> Variable(<span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb5-3" title="3">expr <span class="op">=</span> Apply(<span class="bu">id</span>,x)</a>
<a class="sourceLine" id="cb5-4" title="4">printer <span class="op">=</span> ExprPrint()</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="bu">print</span>(expr.accept(printer))</a></code></pre></div>
<p>to get: <code>(\ #1) x</code> as expected.</p>
<p>Next, we can move onto interpreting the expressions.</p>
        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
